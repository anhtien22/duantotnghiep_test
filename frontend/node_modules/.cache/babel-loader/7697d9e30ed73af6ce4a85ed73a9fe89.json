{"ast":null,"code":"var _jsxFileName = \"D:\\\\D\\u1EF1 \\xC1n T\\u1ED1t Nghi\\u1EC7p\\\\duantotnghiep_test\\\\frontend\\\\src\\\\context\\\\product\\\\ProductState.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport ProductContext from './productContext';\nimport axios from 'axios'; // Function for cleaning null, undefined and empty strings values in objects\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction clean(obj) {\n  for (var propName in obj) {\n    if (obj[propName] === null || obj[propName] === undefined || obj[propName] === '') {\n      delete obj[propName];\n    }\n  }\n\n  return obj;\n} // ------------------------------------------\n// Product State\n// ------------------------------------------\n\n\nconst ProductState = props => {\n  _s();\n\n  const [products, setProducts] = useState([]);\n  const [productsError, setProductsError] = useState(null);\n  const [productsLoading, setProductsLoading] = useState(false);\n  const [productsMessage, setProductsMessage] = useState(null);\n  useEffect(() => {\n    setTimeout(() => {\n      setProductsError(null);\n      setProductsMessage(null);\n    }, 3000);\n  }, [productsError, productsMessage]); // Error Handler function\n\n  const errorHandler = (err, info) => {\n    if (err.response) {\n      setProductsError({\n        variant: 'danger',\n        message: `${info}, ${err.response.data.error}`\n      });\n    } else if (err.request) {\n      setProductsError({\n        variant: 'danger',\n        message: `${info},  Không có phản hồi từ máy chủ!`\n      });\n    } else {\n      setProductsError({\n        variant: 'danger',\n        message: err.message\n      });\n    }\n\n    setProductsLoading(false);\n  }; // get all Products\n\n\n  const getProducts = async (limit, skip, keyword, category) => {\n    try {\n      setProductsLoading(true);\n      const {\n        data\n      } = await axios.get(`/api/products/getAll`, {\n        params: {\n          limit,\n          skip,\n          keyword,\n          category\n        }\n      });\n      setProducts(data.products);\n      setProductsLoading(false);\n      setProductsError(null);\n      return data.totalResults;\n    } catch (err) {\n      errorHandler(err, 'Không thể nhận được sản phẩm');\n    }\n  }; // Add new product\n\n\n  const addProduct = async fromData => {\n    const productBody = clean(fromData);\n    console.log(productBody, ' productBody');\n\n    try {\n      const userToken = JSON.parse(localStorage.getItem('userToken'));\n      const headers = {\n        Authorization: `Bearer ${userToken && userToken}`,\n        'Content-Type': 'multipart/form-data'\n      };\n      setProductsLoading(true);\n      await axios.post('api/products/add', productBody, {\n        headers\n      }); // setProducts([productBody, ...products])\n\n      setProductsMessage({\n        variant: 'success',\n        message: 'Đã thêm sản phẩm thành công!'\n      });\n      setProductsLoading(false);\n      setProductsError(null);\n    } catch (err) {\n      errorHandler(err, 'Không thể thêm sản phẩm');\n    }\n  }; // Delete prdouct \n\n\n  const deleteProduct = async id => {\n    try {\n      setProductsLoading(true);\n      const userToken = JSON.parse(localStorage.getItem('userToken'));\n      const headers = {\n        Authorization: `Bearer ${userToken && userToken}`,\n        'Content-Type': 'multipart/form-data'\n      };\n      const {\n        data\n      } = await axios.delete(`/api/products/${id}`, {\n        headers\n      });\n      setProductsMessage({\n        variant: 'success',\n        message: 'Xóa thành công!'\n      });\n      setProductsLoading(false);\n      setProductsError(null);\n      return data.product;\n    } catch (err) {\n      errorHandler(err, 'Không tìm thấy sản phẩm');\n    }\n  }; // get one product\n\n\n  const getOneProduct = async id => {\n    try {\n      setProductsLoading(true);\n      const {\n        data\n      } = await axios.get(`/api/products/${id}`);\n      setProductsLoading(false);\n      setProductsError(null);\n      return data.product;\n    } catch (err) {\n      errorHandler(err);\n    }\n  }; // Update prdouct details\n\n\n  const updateProductDetails = async (id, name, sku, category, price, description, Stock) => {\n    try {\n      setProductsLoading(true);\n      const userToken = JSON.parse(localStorage.getItem('userToken'));\n      const headers = {\n        Authorization: `Bearer ${userToken && userToken}`\n      };\n      const productBody = clean({\n        name,\n        sku,\n        category,\n        price,\n        description,\n        Stock\n      });\n      await axios.patch(`/api/products/${id}`, productBody, {\n        headers\n      });\n      setProductsMessage({\n        variant: 'success',\n        message: 'Chi tiết sản phẩm được cập nhật!'\n      });\n      setProductsLoading(false);\n      setProductsError(null); // getCategories()\n    } catch (err) {\n      errorHandler(err, 'Không thể cập nhật chi tiết sản phẩm');\n    }\n  }; // Delete prdouct Image\n  // Update prdouct Image\n\n\n  const updateProductImage = async (id, formData) => {\n    try {\n      setProductsLoading(true);\n      const userToken = JSON.parse(localStorage.getItem('userToken'));\n      const headers = {\n        Authorization: `Bearer ${userToken && userToken}`,\n        'Content-Type': 'multipart/form-data'\n      };\n      const {\n        data\n      } = await axios.patch(`api/products/${id}/updateImage`, formData, {\n        headers\n      });\n      setProductsMessage({\n        variant: 'success',\n        message: 'Hình ảnh sản phẩm được cập nhật!'\n      });\n      setProductsLoading(false);\n      setProductsError(null);\n      return data.image;\n    } catch (err) {\n      errorHandler(err, 'Không thể cập nhật hình ảnh');\n    }\n  };\n\n  const newReview = async payload => {\n    try {\n      console.log(payload);\n      setProductsLoading(true);\n      const {\n        data\n      } = await axios.put(\"/api/products/review\", {\n        comment: payload.comment,\n        rating: payload.rating,\n        productId: payload.productId,\n        user: payload.user,\n        name: payload.name\n      });\n      console.log(\"res\", data);\n      setProductsLoading(false); // setProductsError(null)\n      // return data\n    } catch (error) {\n      errorHandler(error, 'Bình luận thất bại');\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(ProductContext.Provider, {\n    value: {\n      products,\n      productsError,\n      productsLoading,\n      productsMessage,\n      addProduct,\n      getProducts,\n      getOneProduct,\n      updateProductDetails,\n      updateProductImage,\n      deleteProduct,\n      errorHandler,\n      newReview\n    },\n    children: props.children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 221,\n    columnNumber: 5\n  }, this);\n};\n\n_s(ProductState, \"dEPufNQ41KkpzXqY5zzw5dCluHM=\");\n\n_c = ProductState;\nexport default ProductState;\n\nvar _c;\n\n$RefreshReg$(_c, \"ProductState\");","map":{"version":3,"sources":["D:/Dự Án Tốt Nghiệp/duantotnghiep_test/frontend/src/context/product/ProductState.js"],"names":["React","useEffect","useState","ProductContext","axios","clean","obj","propName","undefined","ProductState","props","products","setProducts","productsError","setProductsError","productsLoading","setProductsLoading","productsMessage","setProductsMessage","setTimeout","errorHandler","err","info","response","variant","message","data","error","request","getProducts","limit","skip","keyword","category","get","params","totalResults","addProduct","fromData","productBody","console","log","userToken","JSON","parse","localStorage","getItem","headers","Authorization","post","deleteProduct","id","delete","product","getOneProduct","updateProductDetails","name","sku","price","description","Stock","patch","updateProductImage","formData","image","newReview","payload","put","comment","rating","productId","user","children"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react'\r\nimport ProductContext from './productContext'\r\nimport axios from 'axios'\r\n\r\n// Function for cleaning null, undefined and empty strings values in objects\r\nfunction clean(obj) {\r\n  for (var propName in obj) {\r\n    if (\r\n      obj[propName] === null ||\r\n      obj[propName] === undefined ||\r\n      obj[propName] === ''\r\n    ) {\r\n      delete obj[propName]\r\n    }\r\n  }\r\n  return obj\r\n}\r\n\r\n// ------------------------------------------\r\n// Product State\r\n// ------------------------------------------\r\nconst ProductState = props => {\r\n  const [products, setProducts] = useState([])\r\n  const [productsError, setProductsError] = useState(null)\r\n  const [productsLoading, setProductsLoading] = useState(false)\r\n  const [productsMessage, setProductsMessage] = useState(null)\r\n\r\n  useEffect(() => {\r\n    setTimeout(() => {\r\n      setProductsError(null)\r\n      setProductsMessage(null)\r\n    }, 3000)\r\n  }, [productsError, productsMessage])\r\n\r\n  // Error Handler function\r\n  const errorHandler = (err, info) => {\r\n    if (err.response) {\r\n      setProductsError({\r\n        variant: 'danger',\r\n        message: `${info}, ${err.response.data.error}`,\r\n      })\r\n    } else if (err.request) {\r\n      setProductsError({\r\n        variant: 'danger',\r\n        message: `${info},  Không có phản hồi từ máy chủ!`,\r\n      })\r\n    } else {\r\n      setProductsError({ variant: 'danger', message: err.message })\r\n    }\r\n    setProductsLoading(false)\r\n  }\r\n\r\n  // get all Products\r\n  const getProducts = async (limit, skip, keyword, category) => {\r\n    try {\r\n      setProductsLoading(true)\r\n      const { data } = await axios.get(`/api/products/getAll`, {\r\n        params: { limit, skip, keyword, category },\r\n      })\r\n      setProducts(data.products)\r\n      setProductsLoading(false)\r\n      setProductsError(null)\r\n      return data.totalResults\r\n    } catch (err) {\r\n      errorHandler(err, 'Không thể nhận được sản phẩm')\r\n    }\r\n  }\r\n\r\n  // Add new product\r\n  const addProduct = async fromData => {\r\n    const productBody = clean(fromData)\r\n    console.log(productBody, ' productBody')\r\n    try {\r\n      const userToken = JSON.parse(localStorage.getItem('userToken'))\r\n      const headers = {\r\n        Authorization: `Bearer ${userToken && userToken}`,\r\n        'Content-Type': 'multipart/form-data',\r\n      }\r\n      setProductsLoading(true)\r\n      await axios.post('api/products/add', productBody, { headers })\r\n      // setProducts([productBody, ...products])\r\n      setProductsMessage({\r\n        variant: 'success',\r\n        message: 'Đã thêm sản phẩm thành công!',\r\n      })\r\n      setProductsLoading(false)\r\n      setProductsError(null)\r\n    } catch (err) {\r\n      errorHandler(err, 'Không thể thêm sản phẩm')\r\n    }\r\n  }\r\n\r\n  // Delete prdouct \r\n  const deleteProduct = async id => {\r\n    try {\r\n      setProductsLoading(true)\r\n      const userToken = JSON.parse(localStorage.getItem('userToken'))\r\n      const headers = {\r\n        Authorization: `Bearer ${userToken && userToken}`,\r\n        'Content-Type': 'multipart/form-data',\r\n      }\r\n      const { data } = await axios.delete(`/api/products/${id}`, { headers })\r\n      setProductsMessage({\r\n        variant: 'success',\r\n        message: 'Xóa thành công!',\r\n      })\r\n      setProductsLoading(false)\r\n      setProductsError(null)\r\n      return data.product\r\n    } catch (err) {\r\n      errorHandler(err, 'Không tìm thấy sản phẩm')\r\n    }\r\n  }\r\n\r\n  // get one product\r\n  const getOneProduct = async id => {\r\n    try {\r\n      setProductsLoading(true)\r\n      const { data } = await axios.get(`/api/products/${id}`)\r\n      setProductsLoading(false)\r\n      setProductsError(null)\r\n      return data.product\r\n    } catch (err) {\r\n      errorHandler(err)\r\n    }\r\n  }\r\n\r\n  // Update prdouct details\r\n  const updateProductDetails = async (\r\n    id,\r\n    name,\r\n    sku,\r\n    category,\r\n    price,\r\n    description,\r\n    Stock\r\n  ) => {\r\n    try {\r\n      setProductsLoading(true)\r\n      const userToken = JSON.parse(localStorage.getItem('userToken'))\r\n      const headers = {\r\n        Authorization: `Bearer ${userToken && userToken}`,\r\n      }\r\n      const productBody = clean({\r\n        name,\r\n        sku,\r\n        category,\r\n        price,\r\n        description,\r\n        Stock,\r\n      })\r\n      await axios.patch(`/api/products/${id}`, productBody, { headers })\r\n      setProductsMessage({\r\n        variant: 'success',\r\n        message: 'Chi tiết sản phẩm được cập nhật!',\r\n      })\r\n      setProductsLoading(false)\r\n      setProductsError(null)\r\n      // getCategories()\r\n    } catch (err) {\r\n      errorHandler(err, 'Không thể cập nhật chi tiết sản phẩm')\r\n    }\r\n  }\r\n  // Delete prdouct Image\r\n\r\n\r\n  // Update prdouct Image\r\n  const updateProductImage = async (id, formData) => {\r\n    try {\r\n      setProductsLoading(true)\r\n      const userToken = JSON.parse(localStorage.getItem('userToken'))\r\n      const headers = {\r\n        Authorization: `Bearer ${userToken && userToken}`,\r\n        'Content-Type': 'multipart/form-data',\r\n      }\r\n      const { data } = await axios.patch(\r\n        `api/products/${id}/updateImage`,\r\n        formData,\r\n        { headers }\r\n      )\r\n      setProductsMessage({\r\n        variant: 'success',\r\n        message: 'Hình ảnh sản phẩm được cập nhật!',\r\n      })\r\n      setProductsLoading(false)\r\n      setProductsError(null)\r\n      return data.image\r\n    } catch (err) {\r\n      errorHandler(err, 'Không thể cập nhật hình ảnh')\r\n    }\r\n  }\r\n\r\n  const newReview = async (payload) => {\r\n    try {\r\n      console.log(payload);\r\n      setProductsLoading(true)\r\n\r\n      const { data } = await axios.put(\"/api/products/review\",\r\n        {\r\n          comment: payload.comment,\r\n          rating: payload.rating,\r\n          productId: payload.productId,\r\n          user: payload.user,\r\n          name: payload.name\r\n        });\r\n      console.log(\"res\", data);\r\n\r\n\r\n      setProductsLoading(false)\r\n      // setProductsError(null)\r\n      // return data\r\n\r\n    } catch (error) {\r\n      errorHandler(error, 'Bình luận thất bại')\r\n    }\r\n  };\r\n\r\n\r\n\r\n  return (\r\n    <ProductContext.Provider\r\n      value={ {\r\n        products,\r\n        productsError,\r\n        productsLoading,\r\n        productsMessage,\r\n        addProduct,\r\n        getProducts,\r\n        getOneProduct,\r\n        updateProductDetails,\r\n        updateProductImage,\r\n        deleteProduct,\r\n        errorHandler,\r\n        newReview\r\n      } }>\r\n      { props.children }\r\n    </ProductContext.Provider>\r\n  )\r\n}\r\n\r\nexport default ProductState\r\n"]},"metadata":{},"sourceType":"module"}