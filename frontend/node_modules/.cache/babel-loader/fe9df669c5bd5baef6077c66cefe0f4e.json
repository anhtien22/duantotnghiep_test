{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nvar _excluded = [\"prefixCls\", \"src\", \"alt\", \"onClose\", \"afterClose\", \"visible\", \"icons\", \"rootClassName\", \"getContainer\", \"countRender\", \"scaleStep\", \"transitionName\", \"maskTransitionName\"];\nimport * as React from 'react';\nimport Portal from '@rc-component/portal';\nimport Dialog from 'rc-dialog';\nimport CSSMotion from 'rc-motion';\nimport classnames from 'classnames';\nimport addEventListener from \"rc-util/es/Dom/addEventListener\";\nimport KeyCode from \"rc-util/es/KeyCode\";\nimport { warning } from \"rc-util/es/warning\";\nimport useFrameSetState from \"./hooks/useFrameSetState\";\nimport getFixScaleEleTransPosition from \"./getFixScaleEleTransPosition\";\nimport { context } from \"./PreviewGroup\";\nvar useState = React.useState,\n    useEffect = React.useEffect,\n    useCallback = React.useCallback,\n    useRef = React.useRef,\n    useContext = React.useContext;\nvar initialPosition = {\n  x: 0,\n  y: 0\n};\n\nvar Preview = function Preview(props) {\n  var _countRender;\n\n  var prefixCls = props.prefixCls,\n      src = props.src,\n      alt = props.alt,\n      onClose = props.onClose,\n      afterClose = props.afterClose,\n      visible = props.visible,\n      _props$icons = props.icons,\n      icons = _props$icons === void 0 ? {} : _props$icons,\n      rootClassName = props.rootClassName,\n      getContainer = props.getContainer,\n      countRender = props.countRender,\n      _props$scaleStep = props.scaleStep,\n      scaleStep = _props$scaleStep === void 0 ? 0.5 : _props$scaleStep,\n      _props$transitionName = props.transitionName,\n      transitionName = _props$transitionName === void 0 ? 'zoom' : _props$transitionName,\n      _props$maskTransition = props.maskTransitionName,\n      maskTransitionName = _props$maskTransition === void 0 ? 'fade' : _props$maskTransition,\n      restProps = _objectWithoutProperties(props, _excluded);\n\n  var rotateLeft = icons.rotateLeft,\n      rotateRight = icons.rotateRight,\n      zoomIn = icons.zoomIn,\n      zoomOut = icons.zoomOut,\n      close = icons.close,\n      left = icons.left,\n      right = icons.right;\n\n  var _useState = useState(1),\n      _useState2 = _slicedToArray(_useState, 2),\n      scale = _useState2[0],\n      setScale = _useState2[1];\n\n  var _useState3 = useState(0),\n      _useState4 = _slicedToArray(_useState3, 2),\n      rotate = _useState4[0],\n      setRotate = _useState4[1];\n\n  var _useFrameSetState = useFrameSetState(initialPosition),\n      _useFrameSetState2 = _slicedToArray(_useFrameSetState, 2),\n      position = _useFrameSetState2[0],\n      setPosition = _useFrameSetState2[1];\n\n  var imgRef = useRef();\n  var originPositionRef = useRef({\n    originX: 0,\n    originY: 0,\n    deltaX: 0,\n    deltaY: 0\n  });\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      isMoving = _useState6[0],\n      setMoving = _useState6[1];\n\n  var _useContext = useContext(context),\n      previewUrls = _useContext.previewUrls,\n      current = _useContext.current,\n      isPreviewGroup = _useContext.isPreviewGroup,\n      setCurrent = _useContext.setCurrent;\n\n  var previewGroupCount = previewUrls.size;\n  var previewUrlsKeys = Array.from(previewUrls.keys());\n  var currentPreviewIndex = previewUrlsKeys.indexOf(current);\n  var combinationSrc = isPreviewGroup ? previewUrls.get(current) : src;\n  var showLeftOrRightSwitches = isPreviewGroup && previewGroupCount > 1;\n  var showOperationsProgress = isPreviewGroup && previewGroupCount >= 1;\n\n  var _useState7 = useState({\n    wheelDirection: 0\n  }),\n      _useState8 = _slicedToArray(_useState7, 2),\n      lastWheelZoomDirection = _useState8[0],\n      setLastWheelZoomDirection = _useState8[1];\n\n  var onAfterClose = function onAfterClose() {\n    setScale(1);\n    setRotate(0);\n    setPosition(initialPosition);\n  };\n\n  var onZoomIn = function onZoomIn() {\n    setScale(function (value) {\n      return value + scaleStep;\n    });\n    setPosition(initialPosition);\n  };\n\n  var onZoomOut = function onZoomOut() {\n    if (scale > 1) {\n      setScale(function (value) {\n        return value - scaleStep;\n      });\n    }\n\n    setPosition(initialPosition);\n  };\n\n  var onRotateRight = function onRotateRight() {\n    setRotate(function (value) {\n      return value + 90;\n    });\n  };\n\n  var onRotateLeft = function onRotateLeft() {\n    setRotate(function (value) {\n      return value - 90;\n    });\n  };\n\n  var onSwitchLeft = function onSwitchLeft(event) {\n    event.preventDefault(); // Without this mask close will abnormal\n\n    event.stopPropagation();\n\n    if (currentPreviewIndex > 0) {\n      setCurrent(previewUrlsKeys[currentPreviewIndex - 1]);\n    }\n  };\n\n  var onSwitchRight = function onSwitchRight(event) {\n    event.preventDefault(); // Without this mask close will abnormal\n\n    event.stopPropagation();\n\n    if (currentPreviewIndex < previewGroupCount - 1) {\n      setCurrent(previewUrlsKeys[currentPreviewIndex + 1]);\n    }\n  };\n\n  var wrapClassName = classnames(_defineProperty({}, \"\".concat(prefixCls, \"-moving\"), isMoving));\n  var toolClassName = \"\".concat(prefixCls, \"-operations-operation\");\n  var iconClassName = \"\".concat(prefixCls, \"-operations-icon\");\n  var tools = [{\n    icon: close,\n    onClick: onClose,\n    type: 'close'\n  }, {\n    icon: zoomIn,\n    onClick: onZoomIn,\n    type: 'zoomIn'\n  }, {\n    icon: zoomOut,\n    onClick: onZoomOut,\n    type: 'zoomOut',\n    disabled: scale === 1\n  }, {\n    icon: rotateRight,\n    onClick: onRotateRight,\n    type: 'rotateRight'\n  }, {\n    icon: rotateLeft,\n    onClick: onRotateLeft,\n    type: 'rotateLeft'\n  }];\n\n  var onMouseUp = function onMouseUp() {\n    if (visible && isMoving) {\n      var width = imgRef.current.offsetWidth * scale;\n      var height = imgRef.current.offsetHeight * scale; // eslint-disable-next-line @typescript-eslint/no-shadow\n\n      var _imgRef$current$getBo = imgRef.current.getBoundingClientRect(),\n          _left = _imgRef$current$getBo.left,\n          top = _imgRef$current$getBo.top;\n\n      var isRotate = rotate % 180 !== 0;\n      setMoving(false);\n      var fixState = getFixScaleEleTransPosition(isRotate ? height : width, isRotate ? width : height, _left, top);\n\n      if (fixState) {\n        setPosition(_objectSpread({}, fixState));\n      }\n    }\n  };\n\n  var onMouseDown = function onMouseDown(event) {\n    // Only allow main button\n    if (event.button !== 0) return;\n    event.preventDefault(); // Without this mask close will abnormal\n\n    event.stopPropagation();\n    originPositionRef.current.deltaX = event.pageX - position.x;\n    originPositionRef.current.deltaY = event.pageY - position.y;\n    originPositionRef.current.originX = position.x;\n    originPositionRef.current.originY = position.y;\n    setMoving(true);\n  };\n\n  var onMouseMove = function onMouseMove(event) {\n    if (visible && isMoving) {\n      setPosition({\n        x: event.pageX - originPositionRef.current.deltaX,\n        y: event.pageY - originPositionRef.current.deltaY\n      });\n    }\n  };\n\n  var onWheelMove = function onWheelMove(event) {\n    if (!visible) return;\n    event.preventDefault();\n    var wheelDirection = event.deltaY;\n    setLastWheelZoomDirection({\n      wheelDirection: wheelDirection\n    });\n  };\n\n  var onKeyDown = useCallback(function (event) {\n    if (!visible || !showLeftOrRightSwitches) return;\n\n    if (event.keyCode === KeyCode.LEFT) {\n      if (currentPreviewIndex > 0) {\n        setCurrent(previewUrlsKeys[currentPreviewIndex - 1]);\n      }\n    } else if (event.keyCode === KeyCode.RIGHT) {\n      if (currentPreviewIndex < previewGroupCount - 1) {\n        setCurrent(previewUrlsKeys[currentPreviewIndex + 1]);\n      }\n    }\n  }, [currentPreviewIndex, previewGroupCount, previewUrlsKeys, setCurrent, showLeftOrRightSwitches, visible]);\n\n  var onDoubleClick = function onDoubleClick() {\n    if (visible) {\n      if (scale !== 1) {\n        setScale(1);\n      }\n\n      if (position.x !== initialPosition.x || position.y !== initialPosition.y) {\n        setPosition(initialPosition);\n      }\n    }\n  };\n\n  useEffect(function () {\n    var wheelDirection = lastWheelZoomDirection.wheelDirection;\n\n    if (wheelDirection > 0) {\n      onZoomOut();\n    } else if (wheelDirection < 0) {\n      onZoomIn();\n    }\n  }, [lastWheelZoomDirection]);\n  useEffect(function () {\n    var onTopMouseUpListener;\n    var onTopMouseMoveListener;\n    var onMouseUpListener = addEventListener(window, 'mouseup', onMouseUp, false);\n    var onMouseMoveListener = addEventListener(window, 'mousemove', onMouseMove, false);\n    var onScrollWheelListener = addEventListener(window, 'wheel', onWheelMove, {\n      passive: false\n    });\n    var onKeyDownListener = addEventListener(window, 'keydown', onKeyDown, false);\n\n    try {\n      // Resolve if in iframe lost event\n\n      /* istanbul ignore next */\n      if (window.top !== window.self) {\n        onTopMouseUpListener = addEventListener(window.top, 'mouseup', onMouseUp, false);\n        onTopMouseMoveListener = addEventListener(window.top, 'mousemove', onMouseMove, false);\n      }\n    } catch (error) {\n      /* istanbul ignore next */\n      warning(false, \"[rc-image] \".concat(error));\n    }\n\n    return function () {\n      var _onTopMouseUpListener, _onTopMouseMoveListen;\n\n      onMouseUpListener.remove();\n      onMouseMoveListener.remove();\n      onScrollWheelListener.remove();\n      onKeyDownListener.remove();\n      /* istanbul ignore next */\n\n      (_onTopMouseUpListener = onTopMouseUpListener) === null || _onTopMouseUpListener === void 0 ? void 0 : _onTopMouseUpListener.remove();\n      /* istanbul ignore next */\n\n      (_onTopMouseMoveListen = onTopMouseMoveListener) === null || _onTopMouseMoveListen === void 0 ? void 0 : _onTopMouseMoveListen.remove();\n    };\n  }, [visible, isMoving, onKeyDown]);\n  var operations = /*#__PURE__*/React.createElement(React.Fragment, null, showLeftOrRightSwitches && /*#__PURE__*/React.createElement(\"div\", {\n    className: classnames(\"\".concat(prefixCls, \"-switch-left\"), _defineProperty({}, \"\".concat(prefixCls, \"-switch-left-disabled\"), currentPreviewIndex === 0)),\n    onClick: onSwitchLeft\n  }, left), showLeftOrRightSwitches && /*#__PURE__*/React.createElement(\"div\", {\n    className: classnames(\"\".concat(prefixCls, \"-switch-right\"), _defineProperty({}, \"\".concat(prefixCls, \"-switch-right-disabled\"), currentPreviewIndex === previewGroupCount - 1)),\n    onClick: onSwitchRight\n  }, right), /*#__PURE__*/React.createElement(\"ul\", {\n    className: \"\".concat(prefixCls, \"-operations\")\n  }, showOperationsProgress && /*#__PURE__*/React.createElement(\"li\", {\n    className: \"\".concat(prefixCls, \"-operations-progress\")\n  }, (_countRender = countRender === null || countRender === void 0 ? void 0 : countRender(currentPreviewIndex + 1, previewGroupCount)) !== null && _countRender !== void 0 ? _countRender : \"\".concat(currentPreviewIndex + 1, \" / \").concat(previewGroupCount)), tools.map(function (_ref) {\n    var _classnames4;\n\n    var icon = _ref.icon,\n        onClick = _ref.onClick,\n        type = _ref.type,\n        disabled = _ref.disabled;\n    return /*#__PURE__*/React.createElement(\"li\", {\n      className: classnames(toolClassName, (_classnames4 = {}, _defineProperty(_classnames4, \"\".concat(prefixCls, \"-operations-operation-\").concat(type), true), _defineProperty(_classnames4, \"\".concat(prefixCls, \"-operations-operation-disabled\"), !!disabled), _classnames4)),\n      onClick: onClick,\n      key: type\n    }, /*#__PURE__*/React.isValidElement(icon) ? /*#__PURE__*/React.cloneElement(icon, {\n      className: iconClassName\n    }) : icon);\n  })));\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Dialog, _extends({\n    transitionName: transitionName,\n    maskTransitionName: maskTransitionName,\n    closable: false,\n    keyboard: true,\n    prefixCls: prefixCls,\n    onClose: onClose,\n    afterClose: onAfterClose,\n    visible: visible,\n    wrapClassName: wrapClassName,\n    rootClassName: rootClassName,\n    getContainer: getContainer\n  }, restProps), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"\".concat(prefixCls, \"-img-wrapper\"),\n    style: {\n      transform: \"translate3d(\".concat(position.x, \"px, \").concat(position.y, \"px, 0)\")\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    width: props.width,\n    height: props.height,\n    onMouseDown: onMouseDown,\n    onDoubleClick: onDoubleClick,\n    ref: imgRef,\n    className: \"\".concat(prefixCls, \"-img\"),\n    src: combinationSrc,\n    alt: alt,\n    style: {\n      transform: \"scale3d(\".concat(scale, \", \").concat(scale, \", 1) rotate(\").concat(rotate, \"deg)\")\n    }\n  }))), /*#__PURE__*/React.createElement(CSSMotion, {\n    visible: visible,\n    motionName: maskTransitionName\n  }, function (_ref2) {\n    var className = _ref2.className,\n        style = _ref2.style;\n    return /*#__PURE__*/React.createElement(Portal, {\n      open: true,\n      getContainer: getContainer !== null && getContainer !== void 0 ? getContainer : document.body\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: classnames(\"\".concat(prefixCls, \"-operations-wrapper\"), className, rootClassName),\n      style: style\n    }, operations));\n  }));\n};\n\nexport default Preview;","map":{"version":3,"sources":["D:/Dự Án Tốt Nghiệp/duantotnghiep_test/frontend/node_modules/rc-image/es/Preview.js"],"names":["_extends","_objectSpread","_defineProperty","_slicedToArray","_objectWithoutProperties","_excluded","React","Portal","Dialog","CSSMotion","classnames","addEventListener","KeyCode","warning","useFrameSetState","getFixScaleEleTransPosition","context","useState","useEffect","useCallback","useRef","useContext","initialPosition","x","y","Preview","props","_countRender","prefixCls","src","alt","onClose","afterClose","visible","_props$icons","icons","rootClassName","getContainer","countRender","_props$scaleStep","scaleStep","_props$transitionName","transitionName","_props$maskTransition","maskTransitionName","restProps","rotateLeft","rotateRight","zoomIn","zoomOut","close","left","right","_useState","_useState2","scale","setScale","_useState3","_useState4","rotate","setRotate","_useFrameSetState","_useFrameSetState2","position","setPosition","imgRef","originPositionRef","originX","originY","deltaX","deltaY","_useState5","_useState6","isMoving","setMoving","_useContext","previewUrls","current","isPreviewGroup","setCurrent","previewGroupCount","size","previewUrlsKeys","Array","from","keys","currentPreviewIndex","indexOf","combinationSrc","get","showLeftOrRightSwitches","showOperationsProgress","_useState7","wheelDirection","_useState8","lastWheelZoomDirection","setLastWheelZoomDirection","onAfterClose","onZoomIn","value","onZoomOut","onRotateRight","onRotateLeft","onSwitchLeft","event","preventDefault","stopPropagation","onSwitchRight","wrapClassName","concat","toolClassName","iconClassName","tools","icon","onClick","type","disabled","onMouseUp","width","offsetWidth","height","offsetHeight","_imgRef$current$getBo","getBoundingClientRect","_left","top","isRotate","fixState","onMouseDown","button","pageX","pageY","onMouseMove","onWheelMove","onKeyDown","keyCode","LEFT","RIGHT","onDoubleClick","onTopMouseUpListener","onTopMouseMoveListener","onMouseUpListener","window","onMouseMoveListener","onScrollWheelListener","passive","onKeyDownListener","self","error","_onTopMouseUpListener","_onTopMouseMoveListen","remove","operations","createElement","Fragment","className","map","_ref","_classnames4","key","isValidElement","cloneElement","closable","keyboard","style","transform","ref","motionName","_ref2","open","document","body"],"mappings":"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","sourcesContent":["import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nvar _excluded = [\"prefixCls\", \"src\", \"alt\", \"onClose\", \"afterClose\", \"visible\", \"icons\", \"rootClassName\", \"getContainer\", \"countRender\", \"scaleStep\", \"transitionName\", \"maskTransitionName\"];\nimport * as React from 'react';\nimport Portal from '@rc-component/portal';\nimport Dialog from 'rc-dialog';\nimport CSSMotion from 'rc-motion';\nimport classnames from 'classnames';\nimport addEventListener from \"rc-util/es/Dom/addEventListener\";\nimport KeyCode from \"rc-util/es/KeyCode\";\nimport { warning } from \"rc-util/es/warning\";\nimport useFrameSetState from \"./hooks/useFrameSetState\";\nimport getFixScaleEleTransPosition from \"./getFixScaleEleTransPosition\";\nimport { context } from \"./PreviewGroup\";\nvar useState = React.useState,\n    useEffect = React.useEffect,\n    useCallback = React.useCallback,\n    useRef = React.useRef,\n    useContext = React.useContext;\nvar initialPosition = {\n  x: 0,\n  y: 0\n};\n\nvar Preview = function Preview(props) {\n  var _countRender;\n\n  var prefixCls = props.prefixCls,\n      src = props.src,\n      alt = props.alt,\n      onClose = props.onClose,\n      afterClose = props.afterClose,\n      visible = props.visible,\n      _props$icons = props.icons,\n      icons = _props$icons === void 0 ? {} : _props$icons,\n      rootClassName = props.rootClassName,\n      getContainer = props.getContainer,\n      countRender = props.countRender,\n      _props$scaleStep = props.scaleStep,\n      scaleStep = _props$scaleStep === void 0 ? 0.5 : _props$scaleStep,\n      _props$transitionName = props.transitionName,\n      transitionName = _props$transitionName === void 0 ? 'zoom' : _props$transitionName,\n      _props$maskTransition = props.maskTransitionName,\n      maskTransitionName = _props$maskTransition === void 0 ? 'fade' : _props$maskTransition,\n      restProps = _objectWithoutProperties(props, _excluded);\n\n  var rotateLeft = icons.rotateLeft,\n      rotateRight = icons.rotateRight,\n      zoomIn = icons.zoomIn,\n      zoomOut = icons.zoomOut,\n      close = icons.close,\n      left = icons.left,\n      right = icons.right;\n\n  var _useState = useState(1),\n      _useState2 = _slicedToArray(_useState, 2),\n      scale = _useState2[0],\n      setScale = _useState2[1];\n\n  var _useState3 = useState(0),\n      _useState4 = _slicedToArray(_useState3, 2),\n      rotate = _useState4[0],\n      setRotate = _useState4[1];\n\n  var _useFrameSetState = useFrameSetState(initialPosition),\n      _useFrameSetState2 = _slicedToArray(_useFrameSetState, 2),\n      position = _useFrameSetState2[0],\n      setPosition = _useFrameSetState2[1];\n\n  var imgRef = useRef();\n  var originPositionRef = useRef({\n    originX: 0,\n    originY: 0,\n    deltaX: 0,\n    deltaY: 0\n  });\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      isMoving = _useState6[0],\n      setMoving = _useState6[1];\n\n  var _useContext = useContext(context),\n      previewUrls = _useContext.previewUrls,\n      current = _useContext.current,\n      isPreviewGroup = _useContext.isPreviewGroup,\n      setCurrent = _useContext.setCurrent;\n\n  var previewGroupCount = previewUrls.size;\n  var previewUrlsKeys = Array.from(previewUrls.keys());\n  var currentPreviewIndex = previewUrlsKeys.indexOf(current);\n  var combinationSrc = isPreviewGroup ? previewUrls.get(current) : src;\n  var showLeftOrRightSwitches = isPreviewGroup && previewGroupCount > 1;\n  var showOperationsProgress = isPreviewGroup && previewGroupCount >= 1;\n\n  var _useState7 = useState({\n    wheelDirection: 0\n  }),\n      _useState8 = _slicedToArray(_useState7, 2),\n      lastWheelZoomDirection = _useState8[0],\n      setLastWheelZoomDirection = _useState8[1];\n\n  var onAfterClose = function onAfterClose() {\n    setScale(1);\n    setRotate(0);\n    setPosition(initialPosition);\n  };\n\n  var onZoomIn = function onZoomIn() {\n    setScale(function (value) {\n      return value + scaleStep;\n    });\n    setPosition(initialPosition);\n  };\n\n  var onZoomOut = function onZoomOut() {\n    if (scale > 1) {\n      setScale(function (value) {\n        return value - scaleStep;\n      });\n    }\n\n    setPosition(initialPosition);\n  };\n\n  var onRotateRight = function onRotateRight() {\n    setRotate(function (value) {\n      return value + 90;\n    });\n  };\n\n  var onRotateLeft = function onRotateLeft() {\n    setRotate(function (value) {\n      return value - 90;\n    });\n  };\n\n  var onSwitchLeft = function onSwitchLeft(event) {\n    event.preventDefault(); // Without this mask close will abnormal\n\n    event.stopPropagation();\n\n    if (currentPreviewIndex > 0) {\n      setCurrent(previewUrlsKeys[currentPreviewIndex - 1]);\n    }\n  };\n\n  var onSwitchRight = function onSwitchRight(event) {\n    event.preventDefault(); // Without this mask close will abnormal\n\n    event.stopPropagation();\n\n    if (currentPreviewIndex < previewGroupCount - 1) {\n      setCurrent(previewUrlsKeys[currentPreviewIndex + 1]);\n    }\n  };\n\n  var wrapClassName = classnames(_defineProperty({}, \"\".concat(prefixCls, \"-moving\"), isMoving));\n  var toolClassName = \"\".concat(prefixCls, \"-operations-operation\");\n  var iconClassName = \"\".concat(prefixCls, \"-operations-icon\");\n  var tools = [{\n    icon: close,\n    onClick: onClose,\n    type: 'close'\n  }, {\n    icon: zoomIn,\n    onClick: onZoomIn,\n    type: 'zoomIn'\n  }, {\n    icon: zoomOut,\n    onClick: onZoomOut,\n    type: 'zoomOut',\n    disabled: scale === 1\n  }, {\n    icon: rotateRight,\n    onClick: onRotateRight,\n    type: 'rotateRight'\n  }, {\n    icon: rotateLeft,\n    onClick: onRotateLeft,\n    type: 'rotateLeft'\n  }];\n\n  var onMouseUp = function onMouseUp() {\n    if (visible && isMoving) {\n      var width = imgRef.current.offsetWidth * scale;\n      var height = imgRef.current.offsetHeight * scale; // eslint-disable-next-line @typescript-eslint/no-shadow\n\n      var _imgRef$current$getBo = imgRef.current.getBoundingClientRect(),\n          _left = _imgRef$current$getBo.left,\n          top = _imgRef$current$getBo.top;\n\n      var isRotate = rotate % 180 !== 0;\n      setMoving(false);\n      var fixState = getFixScaleEleTransPosition(isRotate ? height : width, isRotate ? width : height, _left, top);\n\n      if (fixState) {\n        setPosition(_objectSpread({}, fixState));\n      }\n    }\n  };\n\n  var onMouseDown = function onMouseDown(event) {\n    // Only allow main button\n    if (event.button !== 0) return;\n    event.preventDefault(); // Without this mask close will abnormal\n\n    event.stopPropagation();\n    originPositionRef.current.deltaX = event.pageX - position.x;\n    originPositionRef.current.deltaY = event.pageY - position.y;\n    originPositionRef.current.originX = position.x;\n    originPositionRef.current.originY = position.y;\n    setMoving(true);\n  };\n\n  var onMouseMove = function onMouseMove(event) {\n    if (visible && isMoving) {\n      setPosition({\n        x: event.pageX - originPositionRef.current.deltaX,\n        y: event.pageY - originPositionRef.current.deltaY\n      });\n    }\n  };\n\n  var onWheelMove = function onWheelMove(event) {\n    if (!visible) return;\n    event.preventDefault();\n    var wheelDirection = event.deltaY;\n    setLastWheelZoomDirection({\n      wheelDirection: wheelDirection\n    });\n  };\n\n  var onKeyDown = useCallback(function (event) {\n    if (!visible || !showLeftOrRightSwitches) return;\n\n    if (event.keyCode === KeyCode.LEFT) {\n      if (currentPreviewIndex > 0) {\n        setCurrent(previewUrlsKeys[currentPreviewIndex - 1]);\n      }\n    } else if (event.keyCode === KeyCode.RIGHT) {\n      if (currentPreviewIndex < previewGroupCount - 1) {\n        setCurrent(previewUrlsKeys[currentPreviewIndex + 1]);\n      }\n    }\n  }, [currentPreviewIndex, previewGroupCount, previewUrlsKeys, setCurrent, showLeftOrRightSwitches, visible]);\n\n  var onDoubleClick = function onDoubleClick() {\n    if (visible) {\n      if (scale !== 1) {\n        setScale(1);\n      }\n\n      if (position.x !== initialPosition.x || position.y !== initialPosition.y) {\n        setPosition(initialPosition);\n      }\n    }\n  };\n\n  useEffect(function () {\n    var wheelDirection = lastWheelZoomDirection.wheelDirection;\n\n    if (wheelDirection > 0) {\n      onZoomOut();\n    } else if (wheelDirection < 0) {\n      onZoomIn();\n    }\n  }, [lastWheelZoomDirection]);\n  useEffect(function () {\n    var onTopMouseUpListener;\n    var onTopMouseMoveListener;\n    var onMouseUpListener = addEventListener(window, 'mouseup', onMouseUp, false);\n    var onMouseMoveListener = addEventListener(window, 'mousemove', onMouseMove, false);\n    var onScrollWheelListener = addEventListener(window, 'wheel', onWheelMove, {\n      passive: false\n    });\n    var onKeyDownListener = addEventListener(window, 'keydown', onKeyDown, false);\n\n    try {\n      // Resolve if in iframe lost event\n\n      /* istanbul ignore next */\n      if (window.top !== window.self) {\n        onTopMouseUpListener = addEventListener(window.top, 'mouseup', onMouseUp, false);\n        onTopMouseMoveListener = addEventListener(window.top, 'mousemove', onMouseMove, false);\n      }\n    } catch (error) {\n      /* istanbul ignore next */\n      warning(false, \"[rc-image] \".concat(error));\n    }\n\n    return function () {\n      var _onTopMouseUpListener, _onTopMouseMoveListen;\n\n      onMouseUpListener.remove();\n      onMouseMoveListener.remove();\n      onScrollWheelListener.remove();\n      onKeyDownListener.remove();\n      /* istanbul ignore next */\n\n      (_onTopMouseUpListener = onTopMouseUpListener) === null || _onTopMouseUpListener === void 0 ? void 0 : _onTopMouseUpListener.remove();\n      /* istanbul ignore next */\n\n      (_onTopMouseMoveListen = onTopMouseMoveListener) === null || _onTopMouseMoveListen === void 0 ? void 0 : _onTopMouseMoveListen.remove();\n    };\n  }, [visible, isMoving, onKeyDown]);\n  var operations = /*#__PURE__*/React.createElement(React.Fragment, null, showLeftOrRightSwitches && /*#__PURE__*/React.createElement(\"div\", {\n    className: classnames(\"\".concat(prefixCls, \"-switch-left\"), _defineProperty({}, \"\".concat(prefixCls, \"-switch-left-disabled\"), currentPreviewIndex === 0)),\n    onClick: onSwitchLeft\n  }, left), showLeftOrRightSwitches && /*#__PURE__*/React.createElement(\"div\", {\n    className: classnames(\"\".concat(prefixCls, \"-switch-right\"), _defineProperty({}, \"\".concat(prefixCls, \"-switch-right-disabled\"), currentPreviewIndex === previewGroupCount - 1)),\n    onClick: onSwitchRight\n  }, right), /*#__PURE__*/React.createElement(\"ul\", {\n    className: \"\".concat(prefixCls, \"-operations\")\n  }, showOperationsProgress && /*#__PURE__*/React.createElement(\"li\", {\n    className: \"\".concat(prefixCls, \"-operations-progress\")\n  }, (_countRender = countRender === null || countRender === void 0 ? void 0 : countRender(currentPreviewIndex + 1, previewGroupCount)) !== null && _countRender !== void 0 ? _countRender : \"\".concat(currentPreviewIndex + 1, \" / \").concat(previewGroupCount)), tools.map(function (_ref) {\n    var _classnames4;\n\n    var icon = _ref.icon,\n        onClick = _ref.onClick,\n        type = _ref.type,\n        disabled = _ref.disabled;\n    return /*#__PURE__*/React.createElement(\"li\", {\n      className: classnames(toolClassName, (_classnames4 = {}, _defineProperty(_classnames4, \"\".concat(prefixCls, \"-operations-operation-\").concat(type), true), _defineProperty(_classnames4, \"\".concat(prefixCls, \"-operations-operation-disabled\"), !!disabled), _classnames4)),\n      onClick: onClick,\n      key: type\n    }, /*#__PURE__*/React.isValidElement(icon) ? /*#__PURE__*/React.cloneElement(icon, {\n      className: iconClassName\n    }) : icon);\n  })));\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Dialog, _extends({\n    transitionName: transitionName,\n    maskTransitionName: maskTransitionName,\n    closable: false,\n    keyboard: true,\n    prefixCls: prefixCls,\n    onClose: onClose,\n    afterClose: onAfterClose,\n    visible: visible,\n    wrapClassName: wrapClassName,\n    rootClassName: rootClassName,\n    getContainer: getContainer\n  }, restProps), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"\".concat(prefixCls, \"-img-wrapper\"),\n    style: {\n      transform: \"translate3d(\".concat(position.x, \"px, \").concat(position.y, \"px, 0)\")\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    width: props.width,\n    height: props.height,\n    onMouseDown: onMouseDown,\n    onDoubleClick: onDoubleClick,\n    ref: imgRef,\n    className: \"\".concat(prefixCls, \"-img\"),\n    src: combinationSrc,\n    alt: alt,\n    style: {\n      transform: \"scale3d(\".concat(scale, \", \").concat(scale, \", 1) rotate(\").concat(rotate, \"deg)\")\n    }\n  }))), /*#__PURE__*/React.createElement(CSSMotion, {\n    visible: visible,\n    motionName: maskTransitionName\n  }, function (_ref2) {\n    var className = _ref2.className,\n        style = _ref2.style;\n    return /*#__PURE__*/React.createElement(Portal, {\n      open: true,\n      getContainer: getContainer !== null && getContainer !== void 0 ? getContainer : document.body\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: classnames(\"\".concat(prefixCls, \"-operations-wrapper\"), className, rootClassName),\n      style: style\n    }, operations));\n  }));\n};\n\nexport default Preview;"]},"metadata":{},"sourceType":"module"}